{
  "version": "ruleset-3.0",
  "description": "DEMAT-BT ‚Äî R√®gles pastilles m√©tier (v3.0: ajout MHS, MES, VISUELLE, MAINT_CORRECTIVE, SURV_FUITE + fix LOCA faux positifs RSF)",
  "detection": {
    "normalize": {
      "uppercase": true,
      "stripAccents": true,
      "punctToSpaces": true,
      "padSpaces": true
    },
    "matchLogic": {
      "mode": "multi_match_stack",
      "maxBadgesPerBT": 1
    }
  },
  "badges": [
    {
      "id": "LOCA",
      "label": "LOCA",
      "icon": "üö®",
      "color": "#E53935",
      "priority": 1000,
      "rules": [
        { "any": ["LOCA", "ADF"] },
        { "all": ["LOCALISATION", "FUITE"] },
        { "all": ["LOCALISATION", "ODEUR"] },
        { "any": ["ODEUR DE GAZ", "ODEUR GAZ"] },
        { "all": ["ODEUR", "GAZ"] },
        { "all": ["FUITE", "GAZ"], "any2": ["ALERTE", "APPEL", "URGENCE", "LOCALISATION", "INTERVENTION"] }
      ],
      "exclude": [
        "PREVENTIVE SUR CI", "PREVENTIVE CI",
        "MAINTENANCE CI CM", "MAINTENANCE CICM",
        "VISITE MAINTENANCE CI", "CI CM MAINTENANCE", "CICM MAINTENANCE",
        "RECHERCHE SYSTEMATIQUE", "RECHERCHE DE FUITE A PIED",
        "SAP", "RSF", "SURVEILLANCE A PIED",
        "SURVEILLANCE DE FUITE"
      ]
    },
    {
      "id": "MHS",
      "label": "MHS",
      "icon": "üî¥",
      "color": "#B71C1C",
      "priority": 980,
      "rules": [
        { "any": ["MISE HORS SERVICE", "MHS"] },
        { "all": ["HORS SERVICE"], "any2": ["COUPURE", "FOURNISSEUR", "ALS", "DEPOSE"] }
      ],
      "exclude": ["REMISE EN SERVICE"]
    },
    {
      "id": "MES",
      "label": "MES",
      "icon": "üü¢",
      "color": "#2E7D32",
      "priority": 970,
      "rules": [
        { "any": ["MISE EN SERVICE", "REMISE EN SERVICE"] },
        { "all": ["POSTE CLIENT"] }
      ],
      "exclude": ["MISE HORS SERVICE", "MHS", "PREVENTIVE", "CICM", "CI CM"]
    },
    {
      "id": "IS_J1",
      "label": "IS J1",
      "icon": "üõë",
      "color": "#C62828",
      "priority": 950,
      "rules": [
        { "any": ["IS J1", "IS JOUR 1", "INTERVENTION SECURITE JOUR 1"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE"]
    },
    {
      "id": "IS_J2",
      "label": "IS J2",
      "icon": "üõë",
      "color": "#C62828",
      "priority": 949,
      "rules": [
        { "any": ["IS J2", "IS JOUR 2", "INTERVENTION SECURITE JOUR 2"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE"]
    },
    {
      "id": "IS_J3",
      "label": "IS J3",
      "icon": "üõë",
      "color": "#C62828",
      "priority": 948,
      "rules": [
        { "any": ["IS J3", "IS JOUR 3", "INTERVENTION SECURITE JOUR 3"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE"]
    },
    {
      "id": "DEP_J1",
      "label": "DEP J1",
      "icon": "üß∞",
      "color": "#FB8C00",
      "priority": 920,
      "rules": [
        { "any": ["DEP J1", "DEP JOUR 1", "DEPANNAGE JOUR 1"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE"]
    },
    {
      "id": "DEP_J2",
      "label": "DEP J2",
      "icon": "üß∞",
      "color": "#FB8C00",
      "priority": 919,
      "rules": [
        { "any": ["DEP J2", "DEP JOUR 2", "DEPANNAGE JOUR 2"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE"]
    },
    {
      "id": "DEP_J3",
      "label": "DEP J3",
      "icon": "üß∞",
      "color": "#FB8C00",
      "priority": 918,
      "rules": [
        { "any": ["DEP J3", "DEP JOUR 3", "DEPANNAGE JOUR 3"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE"]
    },
    {
      "id": "SURV_FUITE",
      "label": "SURV. FUITE",
      "icon": "üëÅÔ∏è",
      "color": "#FF7043",
      "priority": 890,
      "rules": [
        { "all": ["SURVEILLANCE", "FUITE"] },
        { "any": ["SUIVI DES ALERTE DE FUITE"] },
        { "all": ["SURVEILLANCE"], "any2": ["RP2262", "RP2263", "RP2264", "RP2265", "RP2266"] }
      ],
      "exclude": [
        "RECHERCHE SYSTEMATIQUE", "A PIED", "SAP", "RSF",
        "LOCALISATION", "ADF", "ODEUR"
      ]
    },
    {
      "id": "RSF_SAP",
      "label": "RSF / SAP",
      "icon": "üí£",
      "color": "#FDD835",
      "priority": 880,
      "rules": [
        { "any": ["RSF", "SAP", "RECHERCHE DE FUITE", "SURVEILLANCE A PIED", "A PIED", "RECHERCHE SYSTEMATIQUE"] }
      ],
      "exclude": ["PIS", "MANOEUVRABILITE", "PREVENTIVE", "CI CM", "CICM"]
    },
    {
      "id": "MAINT_CORRECTIVE",
      "label": "MAINT CORR.",
      "icon": "üîß‚ö†Ô∏è",
      "color": "#E65100",
      "priority": 860,
      "rules": [
        { "any": ["MAINTENANCE CORRECTIVE"] },
        { "all": ["CORRECTIVE", "BRANCHEMENT"] },
        { "all": ["CHANGEMENT", "COMPTEUR"] },
        { "all": ["REMPLACEMENT", "COMPTEUR"] },
        { "all": ["COMPTEUR", "GRIPPE"] },
        { "all": ["CORRECTIVE"], "any2": ["DETENTE", "COMPTAGE", "AVAL OCG"] }
      ],
      "exclude": ["PREVENTIVE", "VISITE MAINTENANCE", "CICM", "CI CM", "RSF", "SAP"]
    },
    {
      "id": "MAINT_CICM",
      "label": "MAINT CICM",
      "icon": "üè¢‚öôÔ∏è",
      "color": "#1E88E5",
      "priority": 850,
      "rules": [
        { "any": ["CICM", "CI CM", "CI-CM"] },
        { "all": ["MAINTENANCE", "CI"], "any2": ["PREVENTIVE", "VISITE"] },
        { "any": [
            "VISITE MAINTENANCE CI CM", "VISITE MAINTENANCE CI-CM",
            "MAINTENANCE CICM", "MAINTENANCE PREVENTIVE SUR CI CM",
            "MAINTENANCE PREVENTIVE SUR CI-CM", "MAINTENANCE CI CM",
            "DETENDEUR COLLECTIF", "REGULATEUR COLLECTIF"
          ]
        }
      ],
      "exclude": [
        "RSF", "SAP",
        "MAINTENANCE CORRECTIVE", "CORRECTIVE SUR BRANCHEMENT",
        "CHANGEMENT DE COMPTEUR", "REMPLACEMENT COMPTEUR"
      ]
    },
    {
      "id": "MAINT_ROBINET",
      "label": "MAINT ROB.",
      "icon": "üîß",
      "color": "#6A1B9A",
      "priority": 820,
      "rules": [
        { "all": ["ROBINET", "RESEAU"], "any2": ["MAINTENANCE", "REMPLACEMENT", "REPARATION", "GRAISSAGE", "REMISE EN ETAT"] },
        { "all": ["VANNE", "RESEAU"], "any2": ["MAINTENANCE", "REMPLACEMENT", "REPARATION", "GRAISSAGE", "REMISE EN ETAT"] }
      ],
      "exclude": ["RSF", "SAP"]
    },
    {
      "id": "PIS",
      "label": "PIS",
      "icon": "‚öôÔ∏è",
      "color": "#8E24AA",
      "priority": 800,
      "rules": [
        { "any": ["PIS"] },
        { "all": ["MANOEUVRABILITE"], "any2": ["ROBINET", "VANNE", "ORGANE DE COUPURE"] }
      ],
      "exclude": ["RSF", "SAP", "MAINTENANCE", "REMPLACEMENT", "REPARATION", "GRAISSAGE", "REMISE EN ETAT"]
    },
    {
      "id": "EAP",
      "label": "EAP",
      "icon": "üìã",
      "color": "#00ACC1",
      "priority": 760,
      "rules": [
        { "any": ["EAP", "ENTRETIEN ANNUEL", "ENTRETIEN ANNUEL PROFESSIONNEL", "ENTRETIEN PROFESSIONNEL", "PREPARATION EAP", "DEMARCHE ETHIQUE"] }
      ],
      "exclude": []
    },
    {
      "id": "REUNION",
      "label": "R√âUNION",
      "icon": "üë•",
      "color": "#26A69A",
      "priority": 750,
      "rules": [
        { "any": ["REUNION", "REUNION EQUIPE", "POINT EQUIPE", "REUNION OPERATIONNELLE", "REUNION HEBDO", "REUNION MENSUELLE"] }
      ],
      "exclude": ["1/4", "QUART D HEURE", "15 MIN"]
    },
    {
      "id": "TRAVAUX",
      "label": "TRAVAUX",
      "icon": "üõ†Ô∏è",
      "color": "#546E7A",
      "priority": 700,
      "rules": [
        { "any": [
            "TRAVAUX", "CHANTIER",
            "RENOUVELLEMENT DE BRANCHEMENT", "CREATION DE BRANCHEMENT",
            "MODIFICATION BRANCHEMENT", "CONSTRUCTION DE BRANCHEMENT",
            "RACCORDEMENT", "SOUDE", "SOUDAGE", "BRASAGE"
          ]
        }
      ],
      "exclude": [
        "RSF", "SAP", "PIS", "MANOEUVRABILITE",
        "REUNION", "EAP", "ENTRETIEN ANNUEL", "PREPARATION EAP",
        "FORMATION", "PEDAGOGIQUE", "MAINTIEN DE COMPETENCE"
      ]
    },
    {
      "id": "VISUELLE",
      "label": "VISUELLE",
      "icon": "üëÅÔ∏è",
      "color": "#78909C",
      "priority": 680,
      "rules": [
        { "any": ["VISUELLE", "INSPECTION VISUELLE", "CONTROLE VISUEL"] },
        { "all": ["FONTE"], "any2": ["VISUELLE", "INSPECTION", "CONTROLE", "170", "150", "100", "200"] }
      ],
      "exclude": ["CICM", "CI CM", "PREVENTIVE"]
    },
    {
      "id": "IDENT",
      "label": "IDENT",
      "icon": "üîç",
      "color": "#90A4AE",
      "priority": 650,
      "rules": [
        { "any": ["IDENTIFICATION", "REPERAGE", "LEVE DE DOUTE", "POSITION INCERTAINE"] }
      ],
      "exclude": ["RSF", "SAP", "ODEUR", "FUITE"]
    },
    {
      "id": "NEUF",
      "label": "NEUF",
      "icon": "üè¢",
      "color": "#607D8B",
      "priority": 620,
      "rules": [
        { "any": ["IMMEUBLE NEUF", "BATIMENT NEUF", "PROGRAMME NEUF", "MISE EN GAZ IMMEUBLE", "MISE EN SERVICE IMMEUBLE"] }
      ],
      "exclude": ["RENOUVELLEMENT", "DEPANNAGE"]
    },
    {
      "id": "CLIENT",
      "label": "CLIENT",
      "icon": "üë§",
      "color": "#43A047",
      "priority": 600,
      "rules": [
        { "any": ["ACTIVITE CLIENTELE", "RENDEZ VOUS CLIENT", "VERIF BRANCHEMENT", "VERIFIER BRANCHEMENT"] }
      ],
      "exclude": [
        "RSF", "SAP", "TRAVAUX", "PIS", "CI CM", "CICM",
        "MISE HORS SERVICE", "MHS", "MISE EN SERVICE", "REMISE EN SERVICE",
        "MAINTENANCE CORRECTIVE"
      ]
    },
    {
      "id": "MAGASIN",
      "label": "MAGASIN",
      "icon": "üì¶",
      "color": "#8D6E63",
      "priority": 520,
      "rules": [
        { "any": ["MAGASIN", "APPROVISIONNEMENT", "LOGISTIQUE", "STOCK"] }
      ],
      "exclude": []
    },
    {
      "id": "PEDAGO",
      "label": "P√âDAGO",
      "icon": "üéì",
      "color": "#5C6BC0",
      "priority": 480,
      "rules": [
        { "any": ["AIRE PEDAGOGIQUE", "PEDAGOGIQUE", "FORMATION TERRAIN", "EXERCICE", "MISE EN SITUATION", "MAINTIEN DE COMPETENCE"] }
      ],
      "exclude": []
    },
    {
      "id": "COM_1_4",
      "label": "1/4 COM",
      "icon": "üó£Ô∏è",
      "color": "#039BE5",
      "priority": 420,
      "rules": [
        { "any": ["1/4", "QUART D HEURE", "15 MIN"], "any2": ["COM", "SECURITE", "BRIEFING", "COM CLI"] }
      ],
      "exclude": []
    },
    {
      "id": "SORTIE_ASTREINTE",
      "label": "SORTIE ASTR.",
      "icon": "üöí",
      "color": "#D84315",
      "priority": 411,
      "rules": [
        { "any": ["SORTIE ASTREINTE", "INTERVENTION ASTREINTE", "RETOUR ASTREINTE", "APPEL ASTREINTE"] }
      ],
      "exclude": []
    },
    {
      "id": "ASTREINTE",
      "label": "ASTREINTE",
      "icon": "üöí",
      "color": "#FFB74D",
      "priority": 410,
      "rules": [
        { "any": ["ASTREINTE", "PERIODE ASTREINTE", "GARDE"] }
      ],
      "exclude": ["SORTIE ASTREINTE", "INTERVENTION ASTREINTE", "RETOUR ASTREINTE", "APPEL ASTREINTE"]
    }
  ],
  "notes": {
    "ui": {
      "display": {
        "maxBadgesPerBT": 1,
        "stackOrder": [
          "LOCA", "MHS", "MES",
          "IS_J1", "IS_J2", "IS_J3",
          "DEP_J1", "DEP_J2", "DEP_J3",
          "SURV_FUITE", "RSF_SAP",
          "MAINT_CORRECTIVE", "MAINT_CICM", "MAINT_ROBINET",
          "PIS", "EAP", "REUNION",
          "TRAVAUX", "VISUELLE", "IDENT", "NEUF",
          "CLIENT", "MAGASIN", "PEDAGO",
          "COM_1_4", "SORTIE_ASTREINTE", "ASTREINTE"
        ]
      }
    },
    "changelog": {
      "v3.0": [
        "AJOUT MHS: Mise Hors Service (priority 980)",
        "AJOUT MES: Mise En Service (priority 970)",
        "AJOUT VISUELLE: Inspection visuelle (priority 680)",
        "AJOUT MAINT_CORRECTIVE: Maintenance corrective branchement (priority 860)",
        "AJOUT SURV_FUITE: Surveillance de fuite (priority 890)",
        "FIX LOCA: Ajout exclusions RSF/SAP/SURVEILLANCE pour √©viter faux positifs",
        "FIX MAINT_CICM: Retrait OCG des rules + exclusions corrective/compteur",
        "FIX CLIENT: Retrait MISE EN SERVICE/COMPTEUR + ajout exclusions MHS/MES",
        "FIX TRAVAUX: Ajout exclusion MAINTIEN DE COMPETENCE (PEDAGO prime)",
        "StackOrder: R√©ordonn√© avec MHS, MES, SURV_FUITE, MAINT_CORRECTIVE, VISUELLE"
      ],
      "v2.0": [
        "MAINT_CICM: Augmentation priorit√© 840‚Üí850",
        "LOCA: Ajout exclusions fortes maintenance CI-CM/CICM",
        "RSF_SAP: Ajout exclusions PREVENTIVE, CI CM, CICM",
        "REUNION: Priorit√© augment√©e 460‚Üí750",
        "EAP: Priorit√© augment√©e 440‚Üí760",
        "TRAVAUX: Ajout exclusions REUNION, EAP, FORMATION"
      ]
    }
  }
}
